"use strict";function numFixed(t,i){var e=t+"";if(e.length>i)return e;for(var n=e.length;n<i;++n)e="0"+e;return e}localStorage.user_music='[{"src": "./test.mp3"},{"src": "./test1.mp3"},{"src": "./test2.mp3"}]',localStorage.current_index=0,$(document).ready(function(){var t=$(".current_music"),i=["loop","infinite","shuffle"],e=$("audio")[0],n=function(){var t=e.currentTime;$("#c_time").html(numFixed(Math.floor(t/60),2)+":"+numFixed(Math.floor(t)%60,2))},s=function(){m.pointto(e.currentTime,!1),n()},o=null;$(e).bind("progress",function(){this.buffered.length<1||(console.log(this.buffered.end(0)+":"+this.duration),$(".loaded_line").css("width",this.buffered.end(0)/this.duration*100+"%"))}).bind("stalled",function(){$("#playorpause").attr("disabled",!0),$("#previous").attr("disabled",!0),$("#next").attr("disabled",!0)}).bind("loadedmetadata",function(){m.maxValue=this.duration,$("#a_time").html("/ "+numFixed(Math.floor(this.duration/60),2)+":"+numFixed(Math.floor(this.duration)%60,2))}).bind("ended",function(){l.autoNext()}).bind("canplay",function(){$("#playorpause").removeAttr("disabled"),$("#previous").removeAttr("disabled"),$("#next").removeAttr("disabled")}).bind("play",function(){o=setInterval(s,1e3),$("#playorpause > span").attr("class","icon-pause")}).bind("pause",function(){clearInterval(o),$("#playorpause > span").attr("class","icon-play")});var a=function(t,n){t&&(e.src=t.src),$(".play_mode > span").attr("class","icon-"+i[n])},r=function(t){if(t){e.pause(),clearInterval(o),e.src=t.src,m.pointto(0);try{e.play()}catch(t){}o=setInterval(s,1e3)}},l=new MusicList("#music_list",a,r);$(".fly > button").on("click",function(){$(".fly > input").value.trim()}),$("#music_favicon").on("click",function(){e.currentSrc&&(t.hasClass("show")||(t.addClass("show"),t.attr("aria-hidden","false")))}),$("#previous").on("click",function(){l.previous()}),$("#playorpause").on("click",function(){e.paused?e.play():e.pause()}),$("#next").on("click",function(){l.next()});var u=$(".time_bar_tip"),h=u.children("p"),c=function(t,i){e.currentTime=i,n()},d=function(t,i,e,n){var s=i;s<0&&(s=0);var o=numFixed(Math.floor(s/60),2)+":"+numFixed(s%60,2);h.html(o),u.css("left",n-u.width()/2+"px"),u.show()},p=function(t){u.hide()},m=new Rangebar("#time_range",120,0,c,d,p),g=localStorage.fly_state;g=void 0===g||g,$(".switch").on("click",function(){var t=$(this);g?(t.removeClass("on").addClass("off"),t.children("p").html("OFF"),$(".fly").slideToggle("fast"),g=!1,localStorage.fly_state=!1):(t.removeClass("off").addClass("on"),t.children("p").html("ON"),$(".fly").slideToggle("fast"),g=!0,localStorage.fly_state=!0)}),$(".play_mode").on("click",function(){var t=++l.play_mode;t=t>2?0:t,$(this).children("span").attr("class","icon-"+i[t]),localStorage.play_mode=t});var _=$(".volume_control > span"),f=-1,y=localStorage.volume?localStorage.volume:100,v=function(t){0==t?_.attr("class","icon-volume-mute"):t<=33?_.attr("class","icon-volume-low"):t<=66?_.attr("class","icon-volume-medium"):_.attr("class","icon-volume-high")},b=function(t,i){-1==f?(e.volume=i/100,v(i)):f=i/100,localStorage.volume=i};new Rangebar("#volume_range",100,y,b);$(".volume_control").bind("click",function(){-1==f?(f=e.volume,e.volume=0,_.attr("class","icon-volume-blocked")):(e.volume=f,v(100*f),f=-1)});$(".music_list_control").on("click",function(){})});var MusicList=function(t,i,e){this.el=this.buildListView(t),this.music_list=[],this.current_music_index=-1,Object.defineProperty(this,"music_index",{get:function(){return this.current_music_index},set:function(t){this.current_music_index=t,e(this.music_list[t])}}),this.play_mode=0,this.played_history=[],this.max_history_size=40,this.played_history_pos=0,this.loadData(i)};MusicList.prototype.buildListView=function(t){var i=$(t);return i.append("<ul></ul>",{class:"music_ul"}).append("<div></div>",{class:"bottom_triangle"}),i},MusicList.prototype.loadData=function(t){this.music_list=JSON.parse(localStorage.user_music),this.current_music_index=parseInt(localStorage.current_index),this.play_mode=parseInt(localStorage.play_mode),void 0===this.play_mode&&(this.play_mode=0),this.music_list?t(this.music_list[this.current_music_index],this.play_mode):(this.music_list=[],this.current_music_index=-1,this.play_mode=0,t({src:""},this.play_mode))},MusicList.prototype.autoNext=function(){if(0!=this.played_history_pos){var t=this.played_history.length;--this.played_history_pos,this.music_index=this.played_history[t-this.played_history_pos]}switch(this.play_mode){case 0:this.pushHistory(this.current_music_index),this.music_index=(this.current_music_index+1)%this.music_list.length;break;case 1:this.music_index=this.current_music_index;break;case 2:this.pushHistory(this.current_music_index),this.music_index=Math.floor(Math.random()*this.music_list.length)}},MusicList.prototype.next=function(){if(0!=this.played_history_pos){var t=this.played_history.length;--this.played_history_pos,this.music_index=this.played_history[t-this.played_history_pos-1]}switch(this.play_mode){case 0:case 1:this.pushHistory(this.current_music_index),this.music_index=(this.current_music_index+1)%this.music_list.length;break;case 2:this.pushHistory(this.current_music_index),this.music_index=Math.floor(Math.random()*this.music_list.length)}},MusicList.prototype.pushHistory=function(t){this.played_history.length==this.max_history_size&&this.played_history.shift(),this.played_history.push(t)},MusicList.prototype.previous=function(){var t=this.played_history.length;this.played_history_pos<t&&(++this.played_history_pos,this.music_index=this.played_history[t-this.played_history_pos])};var Rangebar=function(){var t,i,e,n,s,o,a;if(arguments.length<2)return console.log("Error arguments for calling Rangebar()\neg. new Rangebar(id, maxValue)\n    new Rangebar(id, maxValue, onpointchange)\n    new Rangebar(id, maxValue, defaultValue, onpointchange)\n    new Rangebar(id, maxValue, defaultValue, onpointchange, onmouseover, onmouseout)\n    new Rangebar(id, maxValue, defaultValue, direction, onpointchange, onmouseover, onmouseout)\n"),null;arguments.length>=2&&(t=arguments[0],i=arguments[1]),3==arguments.length&&(s=arguments[2]),arguments.length>=4&&(n=arguments[2],s=arguments[3]),arguments.length>=6&&(o=arguments[4],a=arguments[5]),arguments.length>=7&&(e=arguments[3],onpointchange=arguments[4],o=arguments[5],a=arguments[6]),n||(n=0),e||(e="horizental"),s||(s=function(){}),o||(o=function(){}),a||(a=function(){}),this.direction=e,this.el=this.buildRangebar($(t)),Object.defineProperty(this,"maxValue",{get:function(){return this.max},set:function(t){this.max=t,this.max>=0&&this.min>=0?this.range=this.max-this.min:this.range=NaN}}),Object.defineProperty(this,"minValue",{get:function(){return this.min},set:function(t){this.min=t,this.max>=0&&this.min>=0?this.range=this.max-this.min:this.range=NaN}}),Object.defineProperty(this,"currentValue",{get:function(){return this.value},set:function(t){this.pointto(t,!1)}}),this.maxValue=i,this.minValue=0,this.ondragged=!1,this.el.bind("pointchange",s),this.el.bind("range_mouseover",o),this.el.bind("range_mouseout",a);var r=this;this.el.bind("mousemove",function(t){r.el.trigger("range_mouseover",[r.postovalue(r.relativePos(t)),r.relativePos(t),"horizental"==r.direction?t.pageX:t.pageY])}),this.el.bind("mouseout",function(t){r.el.trigger("range_mouseout",[r.postovalue(r.relativePos(t)),r.relativePos(t),"horizental"==r.direction?t.pageX:t.pageY])}),this.currentValue=n};Rangebar.prototype.buildRangebar=function(t){t.addClass("range").addClass(this.direction).addClass("pointer");var i=this;t.bind("click",function(t){i.pointtoPos(i.relativePos(t))}).bind("mousemove",function(t){i.ondragged&&i.pointtoPos(i.relativePos(t),!1)}).bind("mouseout",function(t){i.ondragged&&(i.pointtoPos(i.relativePos(t)),i.ondragged=!1)});var e=$("<div></div>").addClass("track");e.append($("<div></div>").addClass("loaded_line")).append($("<div></div>").addClass("track_line"));var n=$("<div></div>").addClass("point");return n.bind("mousedown",function(t){i.ondragged=!0}).bind("mouseup",function(t){i.pointtoPos(i.relativePos(t)),i.ondragged=!1}).bind("mouseout",function(t){i.ondragged&&(i.pointtoPos(i.relativePos(t)),i.ondragged=!1)}),t.append(e).append(n),t},Rangebar.prototype.pointtoPos=function(t,i,e){var n,s,o;1==arguments.length?n=t:2==arguments.length?(n=t,o=i):3==arguments.length&&(n=t,s=i,o=e);this.el.children(".point");this.setPointPos(n),void 0!==s&&null!==s||(this.value=this.postovalue(n)),(void 0===o||o)&&this.el.trigger("pointchange",this.value)},Rangebar.prototype.setPointPos=function(t){var i=this.el.children(".point");"horizental"==this.direction?i.css("left",t-i.width()/2+"px"):i.css("top",t-i.height()/2+"px")},Rangebar.prototype.getWidgetLength=function(){return"horizental"==this.direction?this.el.width():this.el.height()},Rangebar.prototype.pointto=function(t,i){this.value=t,this.pointtoPos(this.valuetopos(t),t,i)},Rangebar.prototype.valuetopos=function(t){return Math.floor(t/this.range*this.getWidgetLength())},Rangebar.prototype.postovalue=function(t){return Math.floor(t/this.getWidgetLength()*this.range)+this.min},Rangebar.prototype.relativePos=function(t){var i=0;return i="horizental"==this.direction?t.pageX-this.el.offset().left:t.pageY-this.el.offset().top,Math.max(Math.min(i,this.getWidgetLength()),0)};